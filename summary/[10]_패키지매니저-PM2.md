# 패키지 매니저 와 PM2

- 패키지 
    - 소프트웨어를 일컫는 여러 가지 표현 중 하나
- 패키지 매니저
    - 패키지를 설치, 업데이트, 삭제하는 등 관리하는 데 도움을 주는 프로그램

---

## PM2 설치

- `PM2` : Node.js로 마든 **프로세스**를 관리해주는 프로그램
    - 프로세스 : 동작 중인 프로그램 (main.js)

- `PM2`는 프로그램을 감시하다가 **의도하지 않게 꺼지거나 소스가 변경될 때 자동으로 재시동**하여 서비스를 안정적으로 유지하게 돕는다.

Node.js로 만든 대부분 프로그램은 npm을 통해 손쉽게 설치할 수 있다.

- window (-g : 컴퓨터의 어느 위치에서나 실행할 수 있게 설정)

```
npm install pm2 -g
```

- 리눅스 macOS

```
sudo npm install pm2 -g
```

---

## PM2 실행

다음과 같은 명령으로 PM2 실행

```
pm2 start main.js(실행할 프로그램)
```

이렇게 실행한 화면에서 'status'가 'online'이면 **실행 중** 이라는 것을 의미한다.

---

## 프로세스 감시

PM2에는 프로세스를 감시하는 기능이 존재한다. 다음과 같은 명령으로 실행할 수 있다.

```
pm2 monit
```

이 명령을 통해 나타나는 프로세스 감시창에서는 pm2를 통해 실행 중인 프로세스의 다양한 정보를 확인할 수 있다.

예를 들어, 실행 중인 프로세스를 강제로 종료시키면 pm2가 이를 감지하여 자동으로 재시동하며, 이를 감시화면에서 확인할 수 있다.

이런 방식으로 PM2를 통해 서비스를 안정적으로 운영할 수 있게 돕는다.


---

## 프로세스 목록 확인과 중단

현재 실행 중인 프로세스 목록을 확인하고 싶을 때는 list 명령을 사용한다.

```
pm2 list
```

프로세스 목록을 확인하여 그중 중단하고 싶은 프로세스가 있다면 `stop` 명령에 이어서 프로세스의 이름을 입력하면 중단할 수 있다.

```
pm2 stop main
```

---

## 소스 파일 감시

PM2가 소스파일을 감시해서 이에 대응하는 기능, 

**지금까지 소스를 고치고 프로그램을 재시동했던 방식을 자동화**할 수 있다.

이 기능은 `--watch` 옵션으로 켤 수 있다.

```
pm2 start main.js --watch
```

또한, 코드에 에러가 발생했을 때, 에러 메시지를 확인할 수 있도록 하기 위해서는 `log` 명령을 사용할 수 있다.

```
pm2 log
```

이 기능은 소스 파일이 변경될 때 마다 감시 결과를 로그로 보여준다.